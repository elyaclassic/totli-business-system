{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-3 no-print">
        <a href="/employees/hiring-docs" class="btn btn-outline-secondary btn-sm"><i class="bi bi-arrow-left"></i> Ro'yxatga</a>
        <div class="d-flex gap-2 align-items-center">
            {% if current_user and current_user.role == 'admin' %}
            {% if not doc.confirmed_at %}
            <form method="POST" action="/employees/hiring-doc/{{ doc.id }}/confirm" class="d-inline" onsubmit="return confirm('Hujjatni tasdiqlashni xohlaysizmi?');">
                <button type="submit" class="btn btn-success btn-sm"><i class="bi bi-check-circle"></i> Tasdiqlash</button>
            </form>
            <form method="POST" action="/employees/hiring-doc/{{ doc.id }}/delete" class="d-inline" onsubmit="return confirm('Hujjatni o\'chirishni xohlaysizmi?');">
                <button type="submit" class="btn btn-danger btn-sm"><i class="bi bi-trash"></i> O'chirish</button>
            </form>
            {% else %}
            <form method="POST" action="/employees/hiring-doc/{{ doc.id }}/cancel-confirm" class="d-inline" onsubmit="return confirm('Tasdiqlashni bekor qilishni xohlaysizmi?');">
                <button type="submit" class="btn btn-warning btn-sm"><i class="bi bi-x-circle"></i> Tasdiqlashni bekor qilish</button>
            </form>
            <span class="text-muted small">O'chirish uchun avval tasdiqlashni bekor qiling.</span>
            {% endif %}
            {% endif %}
            <button type="button" class="btn btn-outline-primary btn-sm" onclick="window.print();"><i class="bi bi-printer"></i> Chop etish</button>
        </div>
    </div>
    <div class="card">
        <div class="card-header">
            <h5 class="mb-1"><i class="bi bi-file-earmark-person"></i> Ishga qabul qilish hujjati</h5>
            <p class="mb-0">
                <strong>Hujjat raqami:</strong> {{ doc.number }} &nbsp;|&nbsp;
                <strong>Hujjat sanasi:</strong> {{ doc.doc_date.strftime('%d.%m.%Y') }}
                {% if doc.confirmed_at %}&nbsp;|&nbsp; <span class="text-success"><i class="bi bi-check-circle"></i> Tasdiqlangan {{ doc.confirmed_at.strftime('%d.%m.%Y %H:%M') }}</span>{% endif %}
            </p>
        </div>
        <div class="card-body">
            <table class="table table-bordered mb-0">
                <tr>
                    <th width="220" class="table-light">Xodim (F.I.O)</th>
                    <td>{{ doc.employee.full_name }}</td>
                </tr>
                <tr>
                    <th class="table-light">Kodi</th>
                    <td>{{ doc.employee.code or '-' }}</td>
                </tr>
                <tr>
                    <th class="table-light">Ishga kirgan sana</th>
                    <td>{% if doc.hire_date %}{{ doc.hire_date.strftime('%d.%m.%Y') }}{% else %}-{% endif %}</td>
                </tr>
                <tr>
                    <th class="table-light">Lavozim</th>
                    <td>{{ doc.position or doc.employee.position or '-' }}</td>
                </tr>
                <tr>
                    <th class="table-light">Bo'lim</th>
                    <td>{{ doc.department or doc.employee.department or '-' }}</td>
                </tr>
                <tr>
                    <th class="table-light">Oylik (so'm)</th>
                    <td>{{ "{:,.0f}".format(doc.salary or 0) }}</td>
                </tr>
                <tr>
                    <th class="table-light">Telefon</th>
                    <td>{{ doc.employee.phone or '-' }}</td>
                </tr>
                {% if doc.note %}
                <tr>
                    <th class="table-light">Izoh</th>
                    <td>{{ doc.note }}</td>
                </tr>
                {% endif %}
            </table>
            <p class="mt-3 mb-0 text-muted small">
                Hujjat yaratilgan: {{ doc.created_at.strftime('%d.%m.%Y %H:%M') }}
            </p>
        </div>
    </div>
</div>
<style>
@media print {
    .no-print, .sidebar, nav.sidebar, .btn, .navbar, header { display: none !important; }
    body { padding: 0 !important; background: #fff !important; }
    .card { border: 1px solid #dee2e6 !important; box-shadow: none !important; }
}
</style>
{% endblock %}
